{# index.html.template #}
<!DOCTYPE html>
<html>
  <head>
<!--    <meta http-equiv="Content-Security-Policy" content="script-src *  'self' 'unsafe-inline' 'unsafe-eval' default-src * data: blob: vscode-webview-resource: ;"> -->
  <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval' data: blob:; script-src * 'unsafe-inline' 'unsafe-eval' data: blob:; style-src * 'unsafe-inline' 'unsafe-eval' data: blob:; img-src * 'unsafe-inline' 'unsafe-eval' data: blob:; connect-src * 'unsafe-inline' 'unsafe-eval' data: blob:; font-src * 'unsafe-inline' 'unsafe-eval' data: blob:; object-src * 'unsafe-inline' 'unsafe-eval' data: blob:; media-src * 'unsafe-inline' 'unsafe-eval' data: blob:; frame-src * 'unsafe-inline' 'unsafe-eval' data: blob:;">
<!--    <meta http-equiv="Content-Security-Policy" content="default-src * data: blob: vscode-webview-resource: 'unsafe-inline' 'unsafe-eval' ; script-src * data: blob: vscode-webview-resource: 'unsafe-inline' 'unsafe-eval';"> -->
    <title>Scalene</title>
    <!-- Assets: embedded for standalone mode, local files otherwise (issue #982) -->
    {% if standalone %}
    <link rel="icon" href="data:image/x-icon;base64,{{ favicon_base64 }}" type="image/x-icon">
    <script>{{ jquery_js }}</script>
    <style>{{ bootstrap_css }}</style>
    <script>{{ bootstrap_js }}</script>
    {% else %}
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <script src="jquery-3.6.0.slim.min.js"></script>
    <link href="bootstrap.min.css" rel="stylesheet">
    <script src="bootstrap.bundle.min.js"></script>
    {% endif %}
    <style>
#vg-tooltip-element {
  z-index: 2000;
}
 body { 
  padding: 0 0 90px 0;
}
    </style>
    {% if standalone %}
    <style>{{ prism_css }}</style>
    {% else %}
    <link href="prism.css" rel="stylesheet">
    {% endif %}
    <style>
      .table-condensed>thead>tr>th, .table-condensed>tbody>tr>th, .table-condensed>tfoot>tr>th, .table-condensed>thead>tr>td, .table-condensed>tbody>tr>td, .table-condensed>tfoot>tr>td{
	  padding: 1px; border-spacing: 0px; border:none;
      }
    form label:hover, form button:hover {
      background-color: black;
      color: white;
    }

    form label:active, form button:active {
      background-color: blue;
      color: white;
    }

    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
	
    .text-and-upload {
      display: inline-flex;
      align-items: center; /* Align items vertically */
      }
      
      /* Ensuring the p tag takes the full width */
    .text-center {
        width: 100%;
        text-align: center;
    }

    /* Styling for the SVG */
    .svg-upload {
        height: 20px;
        width: 20px;
        cursor: pointer;
    }
    
    /* Hiding the file input but keeping it functional */
    #fileinput {
        height: 0;
        width: 0;
        opacity: 0;
        position: absolute;
    }

    /* AI Provider Styles */
    .ai-options {
        font-size: 0.8rem;
        max-width: 450px;
    }
    .ai-options summary {
        color: #0d6efd;
        cursor: pointer;
        font-weight: 500;
    }
    .ai-options hr {
        margin: 0.75rem 0;
        opacity: 0.15;
    }
    .provider-section {
        display: none;
        padding: 0.5rem 0;
    }
    .provider-section.active {
        display: block;
    }
    .form-row {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
    }
    .form-row label {
        width: 130px;
        flex-shrink: 0;
        margin: 0;
    }
    .form-row label a {
        color: #0d6efd;
    }
    .form-row input,
    .form-row select {
        flex: 1;
        font-size: 0.8rem;
        padding: 4px 8px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        min-width: 0;
    }
    .form-row input:focus,
    .form-row select:focus {
        border-color: #86b7fe;
        outline: 0;
        box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
    }
    .input-group {
        display: flex;
        flex: 1;
        min-width: 0;
    }
    .input-group input {
        border-top-right-radius: 0;
        border-bottom-right-radius: 0;
        border-right: none;
    }
    .input-group .btn-toggle {
        padding: 4px 8px;
        border: 1px solid #ced4da;
        border-left: none;
        border-radius: 0 4px 4px 0;
        background: #f8f9fa;
        cursor: pointer;
        font-size: 0.75rem;
        color: #6c757d;
    }
    .input-group .btn-toggle:hover {
        background: #e9ecef;
        color: #495057;
    }
    .validation-icon {
        width: 20px;
        text-align: center;
        flex-shrink: 0;
    }
    .validation-icon.valid { color: #198754; }
    .validation-icon.invalid { color: #dc3545; }
    .advanced-toggle {
        font-size: 0.75rem;
        color: #6c757d;
        cursor: pointer;
        margin-top: 4px;
        user-select: none;
    }
    .advanced-toggle:hover {
        color: #0d6efd;
    }
    .advanced-options {
        display: none;
        margin-top: 8px;
        padding-top: 8px;
        border-top: 1px dashed #dee2e6;
    }
    .advanced-options.show {
        display: block;
    }
    .provider-note {
        font-size: 0.75rem;
        color: #6c757d;
        margin-bottom: 8px;
    }
    .provider-note a {
        color: #0d6efd;
    }
    .optimization-section {
        margin-top: 1rem;
        padding-top: 0.75rem;
        border-top: 1px solid #dee2e6;
    }
    .optimization-section b {
        display: block;
        margin-bottom: 0.5rem;
    }
    .option-row {
        display: flex;
        align-items: center;
        gap: 6px;
        margin-bottom: 4px;
    }
    .option-row label {
        cursor: pointer;
        margin: 0;
    }
    .help-text {
        font-size: 0.75rem;
        color: #6c757d;
        font-style: italic;
        margin-top: 0.75rem;
    }
    .btn-refresh {
        padding: 4px 8px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        background: #f8f9fa;
        cursor: pointer;
        font-size: 0.75rem;
        color: #6c757d;
        flex-shrink: 0;
    }
    .btn-refresh:hover {
        background: #e9ecef;
        color: #495057;
    }
    .btn-refresh:disabled {
        cursor: not-allowed;
        opacity: 0.6;
    }
    .btn-refresh.loading {
        color: #0d6efd;
    }
    </style>
    <!-- Google Analytics - only loads when online (for offline support, issue #982) -->
    <script>
      if (navigator.onLine) {
        var script = document.createElement('script');
        script.async = true;
        script.src = 'https://www.googletagmanager.com/gtag/js?id=G-4JXPHEBMTY';
        document.head.appendChild(script);
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-4JXPHEBMTY');
      }
    </script>

    <script>
      const profile = {{ profile }}
      // API keys from environment variables (if set)
      const envApiKeys = {
        openai: "{{ api_keys.openai_api_key | default('', true) }}",
        anthropic: "{{ api_keys.anthropic_api_key | default('', true) }}",
        gemini: "{{ api_keys.gemini_api_key | default('', true) }}",
        azure: "{{ api_keys.azure_api_key | default('', true) }}",
        azureUrl: "{{ api_keys.azure_api_url | default('', true) }}",
        awsAccessKey: "{{ api_keys.aws_access_key | default('', true) }}",
        awsSecretKey: "{{ api_keys.aws_secret_key | default('', true) }}",
        awsRegion: "{{ api_keys.aws_region | default('', true) }}"
      };
    </script>
    <script>
        function clickToLoadFile() {
            // Trigger the file input when the SVG is clicked
            document.getElementById('fileinput').click();
        }
    </script>
	
  </head>
  <body>
    <div class="header">
      <p class="text-center">
	<a href="https://github.com/plasma-umass/scalene">
	  <!-- Logo (vendored locally for offline support, issue #982) -->
	  {% if standalone %}
	  <img src="data:image/png;base64,{{ logo_base64 }}" height="100">
	  {% else %}
	  <img src="scalene-image.png" height="100">
	  {% endif %}
	</a>
      </p>
    </div>
    <div class="d-flex justify-content-center">
      <details id="ai-optimization-options" class="ai-options">
        <summary>AI optimization options</summary>

        <!-- Provider Selection -->
        <div class="form-row" style="margin-top: 0.75rem;">
          <label for="service-select">Provider:</label>
          <select id="service-select" class="persistent" onchange="toggleServiceFields()">
            <option value="amazon">Amazon Bedrock</option>
            <option value="anthropic">Anthropic</option>
            <option value="azure-openai">Azure OpenAI</option>
            <option value="gemini">Google Gemini</option>
            <option value="openai">OpenAI</option>
            <option value="local">Local (Ollama)</option>
          </select>
        </div>

        <hr />

        <!-- OpenAI -->
        <div id="openai-fields" class="provider-section active">
          <div class="form-row">
            <label for="api-key"><a href="https://platform.openai.com/api-keys" target="_blank">API key</a>:</label>
            <div class="input-group">
              <input type="password" id="api-key" placeholder="sk-..." autocomplete="one-time-code" oninput="checkApiKey(this.value)" />
              <button type="button" class="btn-toggle" onclick="togglePassword(this)">Show</button>
            </div>
            <span id="valid-api-key" class="validation-icon"></span>
          </div>
          <div class="form-row">
            <label for="language-model-openai">Model:</label>
            <select id="language-model-openai" class="persistent">
              <option value="gpt-5.2" selected>GPT-5.2</option>
              <option value="gpt-5.2-pro">GPT-5.2 Pro</option>
              <option value="gpt-5.1">GPT-5.1</option>
              <option value="gpt-5">GPT-5</option>
              <option value="gpt-5-mini">GPT-5 mini</option>
              <option value="gpt-5-nano">GPT-5 nano</option>
              <option value="gpt-4.1">GPT-4.1</option>
              <option value="gpt-4.1-mini">GPT-4.1 mini</option>
              <option value="gpt-4.1-nano">GPT-4.1 nano</option>
              <option value="gpt-4o">GPT-4o</option>
              <option value="o3-pro">o3-pro</option>
              <option value="o3">o3</option>
              <option value="o3-mini">o3-mini</option>
              <option value="o4-mini">o4-mini</option>
            </select>
            <button type="button" class="btn-refresh" onclick="refreshOpenAIModels()" title="Refresh model list">&#8635;</button>
          </div>
          <div class="advanced-toggle" onclick="toggleAdvanced(this)">&#9654; Advanced options</div>
          <div class="advanced-options">
            <div class="form-row">
              <label for="openai-custom-model">Custom model:</label>
              <input type="text" id="openai-custom-model" class="persistent" placeholder="overrides dropdown" />
            </div>
            <div class="form-row">
              <label for="openai-custom-url">Custom URL:</label>
              <input type="text" id="openai-custom-url" class="persistent" placeholder="for compatible servers" />
            </div>
          </div>
        </div>

        <!-- Anthropic -->
        <div id="anthropic-fields" class="provider-section">
          <div class="form-row">
            <label for="anthropic-api-key"><a href="https://console.anthropic.com/" target="_blank">API key</a>:</label>
            <div class="input-group">
              <input type="password" id="anthropic-api-key" class="persistent" placeholder="sk-ant-..." autocomplete="one-time-code" />
              <button type="button" class="btn-toggle" onclick="togglePassword(this)">Show</button>
            </div>
          </div>
          <div class="form-row">
            <label for="language-model-anthropic">Model:</label>
            <select id="language-model-anthropic" class="persistent">
              <option value="claude-sonnet-4-5-20250929" selected>Claude Sonnet 4.5</option>
              <option value="claude-opus-4-5-20251124">Claude Opus 4.5</option>
              <option value="claude-haiku-4-5-20251015">Claude Haiku 4.5</option>
            </select>
          </div>
          <div class="advanced-toggle" onclick="toggleAdvanced(this)">&#9654; Advanced options</div>
          <div class="advanced-options">
            <div class="form-row">
              <label for="anthropic-custom-model">Custom model:</label>
              <input type="text" id="anthropic-custom-model" class="persistent" placeholder="overrides dropdown" />
            </div>
            <div class="form-row">
              <label for="anthropic-custom-url">Custom URL:</label>
              <input type="text" id="anthropic-custom-url" class="persistent" placeholder="for compatible servers" />
            </div>
          </div>
        </div>

        <!-- Google Gemini -->
        <div id="gemini-fields" class="provider-section">
          <div class="form-row">
            <label for="gemini-api-key"><a href="https://aistudio.google.com/apikey" target="_blank">API key</a>:</label>
            <div class="input-group">
              <input type="password" id="gemini-api-key" class="persistent" placeholder="AIza..." autocomplete="one-time-code" />
              <button type="button" class="btn-toggle" onclick="togglePassword(this)">Show</button>
            </div>
          </div>
          <div class="form-row">
            <label for="language-model-gemini">Model:</label>
            <select id="language-model-gemini" class="persistent">
              <option value="gemini-3-pro-preview" selected>Gemini 3 Pro</option>
              <option value="gemini-3-flash-preview">Gemini 3 Flash</option>
              <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
              <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
              <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash Lite</option>
              <option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
              <option value="gemini-2.0-flash-lite">Gemini 2.0 Flash Lite</option>
            </select>
            <button type="button" class="btn-refresh" onclick="refreshGeminiModels()" title="Refresh model list">&#8635;</button>
          </div>
          <div class="advanced-toggle" onclick="toggleAdvanced(this)">&#9654; Advanced options</div>
          <div class="advanced-options">
            <div class="form-row">
              <label for="gemini-custom-model">Custom model:</label>
              <input type="text" id="gemini-custom-model" class="persistent" placeholder="overrides dropdown" />
            </div>
            <div class="form-row">
              <label for="gemini-custom-url">Custom URL:</label>
              <input type="text" id="gemini-custom-url" class="persistent" placeholder="for compatible servers" />
            </div>
          </div>
        </div>

        <!-- Amazon Bedrock -->
        <div id="amazon-fields" class="provider-section">
          <div class="form-row">
            <label for="aws-access-key">Access Key ID:</label>
            <input type="text" id="aws-access-key" class="persistent" placeholder="AKIA..." />
          </div>
          <div class="form-row">
            <label for="aws-secret-key">Secret Key:</label>
            <div class="input-group">
              <input type="password" id="aws-secret-key" class="persistent" placeholder="secret access key" autocomplete="one-time-code" />
              <button type="button" class="btn-toggle" onclick="togglePassword(this)">Show</button>
            </div>
          </div>
          <div class="form-row">
            <label for="aws-region">Region:</label>
            <input type="text" id="aws-region" class="persistent" placeholder="us-east-1" />
          </div>
          <div class="form-row">
            <label for="language-model-amazon">Model:</label>
            <select id="language-model-amazon" class="persistent">
              <option value="us.anthropic.claude-sonnet-4-5-20250929-v1:0" selected>Claude Sonnet 4.5</option>
              <option value="us.anthropic.claude-opus-4-5-20251124-v1:0">Claude Opus 4.5</option>
              <option value="us.anthropic.claude-haiku-4-5-20251015-v1:0">Claude Haiku 4.5</option>
            </select>
          </div>
        </div>

        <!-- Azure OpenAI -->
        <div id="azure-openai-fields" class="provider-section">
          <div class="form-row">
            <label for="azure-api-key">API key:</label>
            <div class="input-group">
              <input type="password" id="azure-api-key" class="persistent" placeholder="Azure API key" autocomplete="one-time-code" />
              <button type="button" class="btn-toggle" onclick="togglePassword(this)">Show</button>
            </div>
          </div>
          <div class="form-row">
            <label for="azure-api-url">Endpoint URL:</label>
            <input type="text" id="azure-api-url" class="persistent" placeholder="https://....openai.azure.com" />
          </div>
          <div class="form-row">
            <label for="language-model-azure">Model:</label>
            <select id="language-model-azure" class="persistent">
              <option value="gpt-4.1" selected>GPT-4.1</option>
              <option value="gpt-4.1-mini">GPT-4.1 mini</option>
              <option value="gpt-4o">GPT-4o</option>
              <option value="o3-mini">o3-mini</option>
            </select>
          </div>
          <div class="advanced-toggle" onclick="toggleAdvanced(this)">&#9654; Advanced options</div>
          <div class="advanced-options">
            <div class="form-row">
              <label for="azure-custom-model">Custom model:</label>
              <input type="text" id="azure-custom-model" class="persistent" placeholder="overrides dropdown" />
            </div>
            <div class="form-row">
              <label for="azure-api-version">API version:</label>
              <input type="text" id="azure-api-version" class="persistent" value="2024-02-15-preview" />
            </div>
          </div>
        </div>

        <!-- Local (Ollama) -->
        <div id="local-fields" class="provider-section">
          <div class="provider-note">
            Run AI locally with <a href="https://ollama.ai/" target="_blank">Ollama</a>.
          </div>
          <div class="form-row">
            <label for="local-ip">Server:</label>
            <input type="text" id="local-ip" class="persistent" value="localhost" style="flex: 0.6;" />
            <span style="margin: 0 4px;">:</span>
            <input type="number" id="local-port" class="persistent" value="11434" style="flex: 0.4;" />
          </div>
          <div id="install-models-message" style="display: none; color: #dc3545; margin: 8px 0;">
            Server not found. Run: <code style="background: #f8f9fa; padding: 2px 6px; border-radius: 3px;">ollama pull codellama</code>
          </div>
          <div id="local-models-list">
            <div class="form-row">
              <label for="language-model-local">Model:</label>
              <div id="language-local-models"></div>
            </div>
          </div>
        </div>

        <!-- Optimization Options -->
        <div class="optimization-section">
          <b>Optimization target</b>
          <div class="option-row">
            <input type="radio" name="optimize-radio" id="optimize-performance" value="performance" class="persistent" checked />
            <label for="optimize-performance">Runtime performance</label>
          </div>
          <div class="option-row">
            <input type="radio" name="optimize-radio" id="optimize-memory" value="memory" class="persistent" />
            <label for="optimize-memory">Memory efficiency</label>
          </div>
          <div class="option-row" style="margin-top: 8px;">
            <input type="checkbox" id="use-gpu-checkbox" class="persistent" />
            <label for="use-gpu-checkbox">Include <span id="accelerator-name">GPU</span> optimizations</label>
          </div>
        </div>

        <div class="help-text">
          Click &#128165; for region optimizations or &#9889; for line optimizations.<br />
          <em>Note: AI-generated suggestions may not always be correct.</em>
        </div>

      </details>
    </div>
    <div id="profile">
    </div>
    {% if standalone %}
    <script type="text/javascript">{{ gui_js }}</script>
    {% else %}
    <script src="scalene-gui-bundle.js"></script>
    {% endif %}
    <script type="text/javascript">
      window.addEventListener("load", () => {
	  load(profile);
      });
    </script>
      <nav class="navbar fixed-bottom navbar-default justify-content-center bg-light bg-opacity-75" style="backdrop-filter: blur(2px);">
	<div class="container justify-content-center">
	  <p class="text-center">
	    <font style="font-size:small">
	      <div class="text-and-upload">
		  <a href="https://github.com/plasma-umass/scalene">Scalene</a> version {{ scalene_version }}, {{ scalene_date }}
		  &nbsp;|&nbsp;
		  <a href="https://github.com/plasma-umass/scalene/issues/new/choose">report an issue or request a feature</a>
		  &nbsp;|&nbsp;
		  <a href="https://github.com/plasma-umass/scalene/issues/58">share your Scalene success stories</a>
		  &nbsp;|&nbsp;
		  <a href="javascript:void(0);" onclick="clickToLoadFile();">load another profile</a>
		<form id="jsonFile" name="jsonFile" enctype="multipart/form-data" method="post" style="display: inline;">
		  <input style="height: 0; width: 0; opacity: 0" type="file" id="fileinput" accept=".json" onchange="loadFile()">
		  <!-- SVG icon -->
		  <svg class="svg-upload" onclick="clickToLoadFile();" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
		    <title>Load another profile (.json)</title>
		    <g data-name="upload">
		      <rect width="16" height="2" x="4" y="4" rx="1" ry="1" transform="rotate(180 12 5)"></rect>
		      <rect width="4" height="2" x="17" y="5" rx="1" ry="1" transform="rotate(90 19 6)"></rect>
		      <rect width="4" height="2" x="3" y="5" rx="1" ry="1" transform="rotate(90 5 6)"></rect>
		      <path d="M8 14a1 1 0 0 1-.8-.4 1 1 0 0 1 .2-1.4l4-3a1 1 0 0 1 1.18 0l4 2.82a1 1 0 0 1 .24 1.39 1 1 0 0 1-1.4.24L12 11.24 8.6 13.8a1 1 0 0 1-.6.2z"></path>
		      <path d="M12 21a1 1 0 0 1-1-1v-8a1 1 0 0 1 2 0v8a1 1 0 0 1-1 1z"></path>
		    </g>
		  </svg>
		</form>
	      </div>
	    </font>
	  </p>
	</div>
      </nav>
  </body>
</html>
